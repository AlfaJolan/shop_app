{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">
    {% if product %}‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å{% else %}‚ûï –ù–æ–≤—ã–π{% endif %} —Ç–æ–≤–∞—Ä
  </h2>

  <form method="post" enctype="multipart/form-data"
        action="{% if product %}/admin/catalog/products/{{ product.id }}/update{% else %}/admin/catalog/products/create{% endif %}">
    
    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è -->
    <div class="mb-3">
      <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
      <input type="text" name="name" class="form-control"
             value="{{ product.name if product else '' }}" required>
    </div>

    <div class="mb-3">
      <label class="form-label">SKU</label>
      <input type="text" name="sku" class="form-control"
             value="{{ product.sku if product else '' }}">
    </div>

    <div class="mb-3">
      <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
      <select name="category_id" class="form-select">
        <option value="">---</option>
        {% for c in categories %}
          <option value="{{ c.id }}" {% if product and product.category_id == c.id %}selected{% endif %}>
            {{ c.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- üÜï –ø–æ–ª–µ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞ -->
    <div class="mb-3">
      <label class="form-label">–ü—Ä–æ–¥–∞–≤–µ—Ü</label>
      <select name="seller_id" class="form-select" required>
        <option value="">---</option>
        {% for s in sellers %}
          <option value="{{ s.id }}" {% if product and product.seller_id == s.id %}selected{% endif %}>
            {{ s.name }} ({{ s.city }})
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">–§–æ—Ç–æ</label>
      <input type="file" name="image" class="form-control">
      {% if product and product.image %}
        <img src="/static/uploads/products/{{ product.image }}"
             style="height:80px; margin-top:10px; border-radius:6px;">
      {% endif %}
    </div>

    <hr class="my-4">

    <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö) -->
    {% if product and product.variants %}
      <h4>–í–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–∞</h4>
      <div id="variants">
        {% for v in product.variants %}
          <div class="row g-2 mb-2 variant-row border p-2 rounded">
            <input type="hidden" name="var_id" value="{{ v.id }}">
            <div class="col-md-3">
              <input type="text" name="var_name" class="form-control"
                     placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞" value="{{ v.name }}">
            </div>
            <div class="col-md-2">
              <input type="number" step="0.01" name="var_price" class="form-control"
                     placeholder="–¶–µ–Ω–∞" value="{{ v.unit_price }}">
            </div>
            <!-- üÜï –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–≤–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª—è: —à—Ç—É–∫ –∏ –∫–æ—Ä–æ–±–æ–∫ -->
            <div class="col-md-2">
              <input type="number" name="var_pieces" class="form-control"
                     placeholder="–®—Ç—É–∫ –≤ –∫–æ—Ä–æ–±–∫–µ">
            </div>
            <div class="col-md-2">
              <input type="number" name="var_boxes" class="form-control"
                     placeholder="–ö–æ—Ä–æ–±–æ–∫" value="0" min="0">
            </div>
            <div class="col-md-2 d-flex align-items-center">
              <label class="form-check-label me-1">–£–¥–∞–ª–∏—Ç—å</label>
              <input type="checkbox" name="delete_variant_id" value="{{ v.id }}">
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- –ù–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã -->
    <h5 class="mt-4">‚ûï –ù–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã</h5>
    <div id="new-variants">
      {% if not product %}
        <!-- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –±–ª–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
        <div class="row g-2 mb-2 border p-2 rounded">
          <div class="col-md-3">
            <input type="text" name="new_name" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞">
          </div>
          <div class="col-md-2">
            <input type="number" step="0.01" name="new_price" class="form-control" placeholder="–¶–µ–Ω–∞">
          </div>
          <!-- üÜï –ø–æ–ª—è –¥–ª—è –Ω–æ–≤—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ -->
          <div class="col-md-2">
            <input type="number" name="new_pieces" class="form-control" placeholder="–®—Ç—É–∫ –≤ –∫–æ—Ä–æ–±–∫–µ">
          </div>
          <div class="col-md-2">
            <input type="number" name="new_boxes" class="form-control" placeholder="–ö–æ—Ä–æ–±–æ–∫" value="0" min="0">
          </div>
        </div>
      {% endif %}
    </div>
    <button type="button" class="btn btn-outline-secondary mt-2" onclick="addNewVariant()">–î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>

    <hr class="my-4">
    <button type="submit" class="btn btn-primary btn-lg">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <a href="/admin/catalog/products" class="btn btn-secondary btn-lg">‚¨Ö –ù–∞–∑–∞–¥</a>
  </form>
</div>

<script>
function addNewVariant() {
  const div = document.createElement("div");
  div.classList.add("row","g-2","mb-2","border","p-2","rounded");
  div.innerHTML = `
    <div class="col-md-3">
      <input type="text" name="new_name" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞">
    </div>
    <div class="col-md-2">
      <input type="number" step="0.01" name="new_price" class="form-control" placeholder="–¶–µ–Ω–∞">
    </div>
    <!-- üÜï –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è –¥–ª—è —à—Ç—É–∫ –∏ –∫–æ—Ä–æ–±–æ–∫ -->
    <div class="col-md-2">
      <input type="number" name="new_pieces" class="form-control" placeholder="–®—Ç—É–∫ –≤ –∫–æ—Ä–æ–±–∫–µ">
    </div>
    <div class="col-md-2">
      <input type="number" name="new_boxes" class="form-control" placeholder="–ö–æ—Ä–æ–±–æ–∫" value="0" min="0">
    </div>`;
  document.getElementById("new-variants").appendChild(div);
}
</script>
{% endblock %}
