{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">üõí –ö–æ—Ä–∑–∏–Ω–∞</h2>

{% if flash %}
  <div class="alert alert-warning">{{ flash }}</div>
{% endif %}

{% if not lines %}
  <p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞. <a href="/" class="link-primary">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</a></p>
{% else %}

  <!-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ -->
  <div class="d-none d-lg-block">
    <table class="table align-middle">
      <thead class="table-light">
        <tr>
          <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
          <th class="text-end">–¶–µ–Ω–∞</th>
          <th class="text-center">–ö–æ–ª-–≤–æ (–æ—Å—Ç–∞—Ç–æ–∫)</th>
          <th class="text-end">–°—É–º–º–∞</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
      {% for l in lines %}
        <tr>
          <td>
            <div class="fw-semibold">{{ l.product_name }}</div>
            <div class="small text-muted">{{ l.variant_name }}</div>
          </td>
          <td class="text-end">{{ "%.2f"|format(l.unit_price) }} ‚Ç∏</td>
          <td class="text-center">
            <form method="post" action="/cart/update" class="d-inline-flex align-items-center gap-2">
              <input type="hidden" name="variant_id" value="{{ l.variant_id }}">
              <input type="number" name="qty" value="{{ l.qty }}" min="0" max="{{ l.stock }}"
                     class="form-control form-control-sm text-center" style="width:70px;"
                     onchange="this.form.submit()">
              <span class="small text-muted">–∏–∑ {{ l.stock }}</span>
            </form>
          </td>
          <td class="text-end fw-semibold">{{ "%.2f"|format(l.line_total) }} ‚Ç∏</td>
          <td class="text-center">
            <form method="post" action="/cart/remove">
              <input type="hidden" name="variant_id" value="{{ l.variant_id }}">
              <button type="submit" class="btn btn-sm btn-outline-danger">‚úñ</button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3" class="text-end fw-bold">–ò—Ç–æ–≥–æ:</td>
          <td class="text-end fw-bold">{{ "%.2f"|format(total) }} ‚Ç∏</td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
  <div class="d-lg-none">
    <div class="list-group mb-3">
      {% for l in lines %}
        <div class="list-group-item">
          <div class="fw-semibold">{{ l.product_name }}</div>
          <div class="small text-muted mb-2">{{ l.variant_name }}</div>
          <div class="d-flex justify-content-between align-items-center">
            <span>{{ "%.2f"|format(l.unit_price) }} ‚Ç∏</span>
            <span class="fw-semibold">{{ "%.2f"|format(l.line_total) }} ‚Ç∏</span>
          </div>
          <form method="post" action="/cart/update" class="d-flex align-items-center gap-2 mt-2">
            <input type="hidden" name="variant_id" value="{{ l.variant_id }}">
            <input type="number" name="qty" value="{{ l.qty }}" min="0" max="{{ l.stock }}"
                   class="form-control form-control-sm" style="width:80px;"
                   onchange="this.form.submit()">
            <span class="small text-muted">–∏–∑ {{ l.stock }}</span>
            <button type="submit" formaction="/cart/remove" class="btn btn-sm btn-outline-danger ms-auto">–£–¥–∞–ª–∏—Ç—å</button>
          </form>
        </div>
      {% endfor %}
    </div>
    <div class="text-end fw-bold mb-3">–ò—Ç–æ–≥–æ: {{ "%.2f"|format(total) }} ‚Ç∏</div>
  </div>

  <!-- –§–æ—Ä–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ -->
  <h3 class="mt-4">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>
  <form method="post" action="/checkout" class="row g-3" style="max-width:600px;">
    <div class="col-12 col-md-6">
      <label class="form-label">–ò–º—è</label>
      <input name="customer_name" class="form-control" placeholder="–í–∞—à–µ –∏–º—è">
    </div>
    <div class="col-12 col-md-6">
      <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
      <input name="phone" class="form-control" placeholder="+7...">
    </div>
    <div class="col-12 col-md-6">
      <label class="form-label">–ò–º—è –ü—Ä–æ–¥–∞–≤—Ü–∞</label>
      <input name="seller_name" class="form-control" placeholder="–ò–º—è –ü—Ä–æ–¥–∞–≤—Ü–∞">
    </div>
    <div class="col-12 col-md-6">
      <label class="form-label">–ì–æ—Ä–æ–¥</label>
      <input name="city_name" class="form-control" placeholder="–í–∞—à –≥–æ—Ä–æ–¥">
    </div>
    <div class="col-12">
      <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
      <textarea name="comment" rows="3" class="form-control" placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –∫ –∑–∞–∫–∞–∑—É (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
    </div>
    <div class="col-12">
      <button type="submit" class="btn btn-primary w-100 py-2">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>
  </form>

{% endif %}
{% endblock %}
