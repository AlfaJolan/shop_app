{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">–ù–∞–∫–ª–∞–¥–Ω–∞—è ‚Ññ {{ inv.id }}</h2>
<p class="text-muted">–î–∞—Ç–∞: {{ inv.created_at.strftime("%Y-%m-%d %H:%M") }}</p>

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ –∏ –∑–∞–∫–∞–∑–µ -->
<ul class="list-group mb-4">
  <li class="list-group-item"><strong>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å:</strong> {{ inv.customer_name or "‚Äî" }}</li>
  <li class="list-group-item"><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ inv.phone or "‚Äî" }}</li>
  <li class="list-group-item"><strong>–ü—Ä–æ–¥–∞–≤–µ—Ü:</strong> {{ inv.seller_name or "‚Äî" }}</li>
  <li class="list-group-item"><strong>–ì–æ—Ä–æ–¥:</strong> {{ inv.city_name or "‚Äî" }}</li>
  <li class="list-group-item"><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> {{ inv.comment or "‚Äî" }}</li>
</ul>

<!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
<div class="table-responsive">
  <table class="table align-middle">
    <thead class="table-light">
      <tr>
        <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
        <th>–§–æ—Ç–æ</th>
        <th>–í–∞—Ä–∏–∞–Ω—Ç</th>
        <th class="text-end">–ö–æ–ª-–≤–æ</th>
        <th class="text-end">–¶–µ–Ω–∞</th>
        <th class="text-end">–°—É–º–º–∞</th>
      </tr>
    </thead>
    <tbody>
    {% for it in inv.items %}
      <tr>
        <td>
          <div class="fw-semibold">{{ it.product_name }}</div>
          <div class="small text-muted">{{ it.variant_name }}</div>
        </td>
        <td>{{ it.seller_name }}</td>
        <td style="width:70px;">
          {% if it.product_image %}
            <img src="/static/uploads/products/{{ it.product_image }}" alt=""
                 class="img-thumbnail" style="width:64px; height:64px; object-fit:contain;">
          {% else %} ‚Äî {% endif %}
        </td>
        <td>{{ it.variant_name }}</td>
        <td class="text-end">
          {% if it.qty_original != it.qty_final %}
            <s class="text-muted">{{ it.qty_original }}</s> ‚Üí <b>{{ it.qty_final }}</b>
          {% else %}
            {{ it.qty_final }}
          {% endif %}
        </td>
        <td class="text-end">
          {% if it.unit_price_original != it.unit_price_final %}
            <s class="text-muted">{{ "%.2f"|format(it.unit_price_original) }}</s> ‚Üí
            <b>{{ "%.2f"|format(it.unit_price_final) }}</b> ‚Ç∏
          {% else %}
            {{ "%.2f"|format(it.unit_price_final) }} ‚Ç∏
          {% endif %}
        </td>
        <td class="text-end">
          {% if it.line_total_original != it.line_total_final %}
            <s class="text-muted">{{ "%.2f"|format(it.line_total_original) }}</s> ‚Üí
            <b>{{ "%.2f"|format(it.line_total_final) }}</b> ‚Ç∏
          {% else %}
            {{ "%.2f"|format(it.line_total_final) }} ‚Ç∏
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="6" class="text-end fw-bold">–ò—Ç–æ–≥–æ:</td>
        <td class="text-end fw-bold">{{ "%.2f"|format(inv.total_amount_final) }} ‚Ç∏</td>
      </tr>
    </tfoot>
  </table>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
<div class="mt-4 d-flex flex-wrap gap-2">
  <a href="/invoice/{{ inv.id }}/export.pdf?pkey={{ inv.pkey }}" class="btn btn-outline-primary">
    üìÑ –°–∫–∞—á–∞—Ç—å PDF
  </a>
  <a href="/invoice/{{ inv.id }}/export.xlsx?pkey={{ inv.pkey }}" class="btn btn-outline-success">
    üìä –°–∫–∞—á–∞—Ç—å XLSX
  </a>
  <a href="https://wa.me/{{ inv.phone|replace(' ', '') }}?text=–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!%20–í–∞—à–∞%20–Ω–∞–∫–ª–∞–¥–Ω–∞—è%20‚Ññ{{ inv.id }}%20–æ—Ç%20{{ inv.created_at.strftime('%Y-%m-%d') }}%20‚Äî%20{{ invoice_url }}"
   target="_blank"
   class="btn btn-success">
  üí¨ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ WhatsApp
  </a>

</div>

{% endblock %}
