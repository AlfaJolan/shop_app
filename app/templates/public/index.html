{% extends "base.html" %}
{% block content %}
<h2>–ö–∞—Ç–∞–ª–æ–≥</h2>

{# –ö–Ω–æ–ø–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –≤ —à–∞–ø–∫–µ #}
<div style="display:flex; justify-content:flex-end; margin-bottom:12px;">
  <a href="/cart"
     style="display:inline-flex; align-items:center; gap:8px;
            background:#1890ff; color:#fff; text-decoration:none;
            padding:10px 16px; border-radius:10px; font-weight:600;
            box-shadow:0 6px 16px rgba(24,144,255,0.35);">
    üõí <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
    {% if cart_count and cart_count > 0 %}
      <span style="background:#fff; color:#1890ff; font-size:12px;
                   border-radius:999px; padding:2px 8px; font-weight:700;">
        {{ cart_count }}
      </span>
    {% endif %}
  </a>
</div>

{# Flash-—Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É / –æ—à–∏–±–æ–∫ —Å–∫–ª–∞–¥–∞ #}
{% if flash %}
  <div style="padding:10px; background:#e6fffb; border:1px solid #87e8de; border-radius:8px; margin-bottom:12px;">
    {{ flash }}
  </div>
{% endif %}

<div class="grid">
  {% for p in products %}
    <div class="card">
      {% if p.image %}
        <img src="/static/uploads/products/{{ p.image }}" alt="{{ p.name }}" class="thumb">
      {% else %}
        <img src="/static/no-photo.png" alt="–Ω–µ—Ç —Ñ–æ—Ç–æ" class="thumb">
      {% endif %}

      <!-- üÜï –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ -->
      <h3 style="margin:8px 0; font-size:18px; font-weight:600;">
        {{ p.name }}
      </h3>

      {% if p.variants %}
        <ul class="variants">
          {% for v in p.variants %}
            <li class="variant-row">
              <span>
                {{ v.name }} ‚Äî {{ "%.2f"|format(v.unit_price) }} ‚Ç∏
                {# –µ—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å v.stock –≤ –æ–±—ä–µ–∫—Ç–µ, –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: #}
                {% if v.stock is defined %}
                  <span style="font-size:12px; color:#999;">(–≤ –Ω–∞–ª–∏—á–∏–∏: {{ v.stock }})</span>
                {% endif %}
              </span>

              <form method="post" action="/cart/add" class="add-form">
                <input type="hidden" name="product_id" value="{{ p.id }}">
                <input type="hidden" name="variant_id" value="{{ v.id }}">
                <input type="number" name="qty" value="1" min="1" class="qty">
                {% if v.stock is defined and v.stock|int <= 0 %}
                  <button type="button" disabled title="–ù–µ—Ç –Ω–∞ —Å–∫–ª–∞–¥–µ">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</button>
                {% else %}
                  <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
                {% endif %}
              </form>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div>–ù–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</div>
      {% endif %}

      <!-- üÜï –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü–∞ -->
      {% if p.seller %}
        <div style="margin-top:8px; font-size:14px; color:#555;">
          –ü—Ä–æ–¥–∞–≤–µ—Ü: <strong>{{ p.seller.name }}</strong>
          {% if p.seller.city %} ({{ p.seller.city }}){% endif %}
        </div>
      {% endif %}
    </div>
  {% endfor %}
</div>
{% endblock %}
