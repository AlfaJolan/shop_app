{% extends "base.html" %}
{% block content %}
<h2>–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç</h2>
<p>–°–ø–∞—Å–∏–±–æ! –í–∞—à –∑–∞–∫–∞–∑ ‚Ññ <b>{{ order.id }}</b> –æ—Ç {{ order.created_at.strftime("%Y-%m-%d %H:%M") }}.</p>

{# --- –ë–ª–æ–∫ –Ω–∞–∫–ª–∞–¥–Ω–æ–π (–ø–æ–∫–∞–∂–µ—Ç—Å—è, –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ) --- #}
{% if invoice_id and invoice_pkey %}
  <div style="margin:14px 0; padding:12px; border:1px solid #e6f4ff; background:#f5faff; border-radius:10px;">
    <div style="font-weight:700; margin-bottom:8px;">–ù–∞–∫–ª–∞–¥–Ω–∞—è —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞</div>
    <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:center;">
      <a href="/invoice/{{ invoice_id }}?pkey={{ invoice_pkey }}" target="_blank"
         style="display:inline-flex; align-items:center; gap:8px; background:#1677ff; color:#fff; text-decoration:none; padding:8px 12px; border-radius:8px; font-weight:600; box-shadow:0 4px 12px rgba(22,119,255,.25);">
        üìÑ –û—Ç–∫—Ä—ã—Ç—å –Ω–∞–∫–ª–∞–¥–Ω—É—é
      </a>
      <button type="button" onclick="copyInvoiceLink()"
              style="display:inline-flex; align-items:center; gap:8px; background:#fff; color:#1677ff; border:1px solid #91caff; padding:8px 12px; border-radius:8px; cursor:pointer;">
        üîó –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
      </button>
      <span id="copy-status" style="font-size:12px; color:#52c41a; display:none;">–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞</span>
    </div>
    <script>
      function copyInvoiceLink() {
        const url = `${window.location.origin}/invoice/{{ invoice_id }}?pkey={{ invoice_pkey }}`;
        navigator.clipboard.writeText(url).then(() => {
          const el = document.getElementById('copy-status');
          el.style.display = 'inline';
          setTimeout(() => el.style.display = 'none', 2000);
        });
      }
    </script>
  </div>
{% endif %}

<h3>–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞</h3>
<div style="overflow-x:auto;">
  <table style="width:100%; border-collapse:collapse;">
    <thead>
      <tr>
        <th style="text-align:left; border-bottom:1px solid #eee; padding:8px;">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
        <th style="text-align:right; border-bottom:1px solid #eee; padding:8px;">–¶–µ–Ω–∞</th>
        <th style="text-align:center; border-bottom:1px solid #eee; padding:8px;">–ö–æ–ª-–≤–æ</th>
        <th style="text-align:right; border-bottom:1px solid #eee; padding:8px;">–°—É–º–º–∞</th>
      </tr>
    </thead>
    <tbody>
    {% for l in lines %}
      <tr>
        <td style="padding:8px;">
          <div style="font-weight:600;">{{ l.product_name }}</div>
          <div style="font-size:12px; color:#666;">{{ l.variant_name }}</div>
        </td>
        <td style="padding:8px; text-align:right;">{{ "%.2f"|format(l.unit_price) }} ‚Ç∏</td>
        <td style="padding:8px; text-align:center;">{{ l.qty }}</td>
        <td style="padding:8px; text-align:right; font-weight:600;">{{ "%.2f"|format(l.line_total) }} ‚Ç∏</td>
      </tr>
    {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="3" style="padding:8px; text-align:right; font-weight:700;">–ò—Ç–æ–≥–æ:</td>
        <td style="padding:8px; text-align:right; font-weight:700;">{{ "%.2f"|format(total) }} ‚Ç∏</td>
      </tr>
    </tfoot>
  </table>
</div>

<h3 style="margin-top:16px;">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
<ul>
  <li>–ò–º—è: {{ order.customer_name or "‚Äî" }}</li>
  <li>–¢–µ–ª–µ—Ñ–æ–Ω: {{ order.phone or "‚Äî" }}</li>
  <li>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: {{ order.comment or "‚Äî" }}</li>
</ul>

<p style="margin-top:12px;"><a href="/">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥</a></p>
{% endblock %}
