{% extends "base.html" %}
{% block content %}
<div class="card shadow-sm">
  <div class="card-body">
    <h2 class="card-title mb-3">‚úÖ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç</h2>
    <p class="mb-3">
      –°–ø–∞—Å–∏–±–æ! –í–∞—à –∑–∞–∫–∞–∑ ‚Ññ <b>{{ order.id }}</b> –æ—Ç 
      <span class="text-muted">{{ order.created_at.strftime("%Y-%m-%d %H:%M") }}</span>.
    </p>

    {# --- –ë–ª–æ–∫ –Ω–∞–∫–ª–∞–¥–Ω–æ–π --- #}
    {% if invoice_id and invoice_pkey %}
      <div class="alert alert-info">
        <div class="fw-semibold mb-2">–ù–∞–∫–ª–∞–¥–Ω–∞—è —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞</div>
        <div class="d-flex flex-wrap gap-2 align-items-center">
          <a href="/invoice/{{ invoice_id }}?pkey={{ invoice_pkey }}" 
             target="_blank" class="btn btn-primary">
            üìÑ –û—Ç–∫—Ä—ã—Ç—å –Ω–∞–∫–ª–∞–¥–Ω—É—é
          </a>
          <button type="button" onclick="copyInvoiceLink()" 
                  class="btn btn-outline-primary">
            üîó –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
          </button>
          <span id="copy-status" class="small text-success d-none">–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞</span>
        </div>
      </div>
      <script>
        function copyInvoiceLink() {
          const url = `${window.location.origin}/invoice/{{ invoice_id }}?pkey={{ invoice_pkey }}`;
          navigator.clipboard.writeText(url).then(() => {
            const el = document.getElementById('copy-status');
            el.classList.remove('d-none');
            setTimeout(() => el.classList.add('d-none'), 2000);
          });
        }
      </script>
    {% endif %}

    <h3 class="mt-4">–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞</h3>
    <div class="table-responsive">
      <table class="table align-middle">
        <thead class="table-light">
          <tr>
            <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
            <th class="text-end">–¶–µ–Ω–∞</th>
            <th class="text-center">–ö–æ–ª-–≤–æ</th>
            <th class="text-end">–°—É–º–º–∞</th>
          </tr>
        </thead>
        <tbody>
        {% for l in lines %}
          <tr>
            <td>
              <div class="fw-semibold">{{ l.product_name }}</div>
              <div class="small text-muted">{{ l.variant_name }}</div>
            </td>
            <td class="text-end">{{ "%.2f"|format(l.unit_price) }} ‚Ç∏</td>
            <td class="text-center">{{ l.qty }}</td>
            <td class="text-end fw-semibold">{{ "%.2f"|format(l.line_total) }} ‚Ç∏</td>
          </tr>
        {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <td colspan="3" class="text-end fw-bold">–ò—Ç–æ–≥–æ:</td>
            <td class="text-end fw-bold">{{ "%.2f"|format(total) }} ‚Ç∏</td>
          </tr>
        </tfoot>
      </table>
    </div>

    <h3 class="mt-4">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
    <ul class="list-group mb-3">
      <li class="list-group-item"><strong>–ò–º—è:</strong> {{ order.customer_name or "‚Äî" }}</li>
      <li class="list-group-item"><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ order.phone or "‚Äî" }}</li>
      <li class="list-group-item"><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> {{ order.comment or "‚Äî" }}</li>
    </ul>

    <a href="/" class="btn btn-success">‚¨Ö –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥</a>
  </div>
</div>
{% endblock %}
